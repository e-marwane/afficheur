(()=>{"use strict";function e(){let e=new TextDecoder("utf-8");return{concat(e,t){let n=new Uint8Array(e.length+t.length);return n.set(e),n.set(t,e.length),n},copy(e,t,n){let i=new Uint8Array(n-t);return i.set(e.subarray(t,n)),i},toUtf8String:(t,n,i)=>e.decode(t.subarray(n,i))}}function t(t,n){let i,s,a=null!=n?n:e(),r=!1,o=!1,l=!1;function c(e){let n,d=0;for(i?(n=0===e.length?0:i.length,e=a.concat(i,e)):n=0;n<e.length;){let i=e[n];if(10===i){if(!o){let i=n>0&&13===e[n-1]?n-1:n;if(r)return;if(l=!1===t.next(a.toUtf8String(e,d,i)),d=n+1,l)break}}else 34===i&&(o=!o);n++}if(i=d<e.length?a.copy(e,d,e.length):void 0,l){if(t.useResume)return void t.useResume((()=>{l=!1,c(new Uint8Array(0))}));p.error(new Error("Unable to pause, useResume is not configured!")),l=!1}s&&(s(),s=void 0)}let p={next(e){if(!r)try{return c(e),!l}catch(e){this.error(e)}return!0},error(e){r||(r=!0,t.error(e))},complete(){r||(i&&t.next(a.toUtf8String(i,0,i.length)),r=!0,t.complete())}};return t.useCancellable&&(p.useCancellable=e=>{t.useCancellable&&t.useCancellable({cancel(){e.cancel(),i=void 0,p.complete()},isCancelled:()=>e.isCancelled()})}),t.useResume&&(p.useResume=e=>{s=e}),p}async function*n(t,n){let i,s=null!=n?n:e(),a=!1;for await(let e of t){let t,n=0;for(i?(t=i.length,e=s.concat(i,e)):t=0;t<e.length;){let i=e[t];if(10===i){if(!a){let i=t>0&&13===e[t-1]?t-1:t;yield s.toUtf8String(e,n,i),n=t+1}}else 34===i&&(a=!a);t++}i=n<e.length?s.copy(e,n,e.length):void 0}i&&(yield s.toUtf8String(i,0,i.length))}var i=class{constructor(){this._reuse=!1}get reuse(){return this._reuse}set reuse(e){e&&!this.reusedValues&&(this.reusedValues=new Array(10)),this._reuse=e}withReuse(){return this.reuse=!0,this}splitLine(e){if(null==e)return this.lastSplitLength=0,[];let t=0,n=0,i=this._reuse?this.reusedValues:[],s=0;for(let a=0;a<e.length;a++){let r=e[a];if(","===r){if(t%2==0){let r=this.getValue(e,n,a,t);this._reuse?i[s++]=r:i.push(r),n=a+1,t=0}}else'"'===r&&t++}let a=this.getValue(e,n,e.length,t);return this._reuse?(i[s]=a,this.lastSplitLength=s+1):(i.push(a),this.lastSplitLength=i.length),i}getValue(e,t,n,i){return t===e.length?"":0===i?e.substring(t,n):2===i?e.substring(t+1,n-1):e.substring(t+1,n-1).replace(/""/gi,'"')}},s=e=>e,a={boolean:e=>""===e?null:"true"===e,unsignedLong:e=>""===e?null:+e,long:e=>""===e?null:+e,double(e){switch(e){case"":return null;case"+Inf":return Number.POSITIVE_INFINITY;case"-Inf":return Number.NEGATIVE_INFINITY;default:return+e}},string:s,base64Binary:s,duration:e=>""===e?null:e,"dateTime:RFC3339":e=>""===e?null:e},r=class{get(e){var t;let n=e[this.index];return(""===n||void 0===n)&&this.defaultValue&&(n=this.defaultValue),(null!=(t=a[this.dataType])?t:s)(n)}},o=Object.freeze({label:"",dataType:"",group:!1,defaultValue:"",index:Number.MAX_SAFE_INTEGER,get:()=>{}});function l(){return new r}var c=[404,408,425,429,500,502,503,504],p=class extends Error{constructor(e){super(e),this.name="IllegalArgumentError",Object.setPrototypeOf(this,p.prototype)}},d=class extends Error{constructor(e,t,n,i,s,a){if(super(),this.statusCode=e,this.statusMessage=t,this.body=n,this.contentType=s,Object.setPrototypeOf(this,d.prototype),a)this.message=a;else if(n){if(null!=s&&s.startsWith("application/json"))try{this.json=JSON.parse(n),this.message=this.json.message,this.code=this.json.code}catch(e){}this.message||(this.message=`${e} ${t} : ${n}`)}else this.message=`${e} ${t}`;this.name="HttpError",this.setRetryAfter(i)}setRetryAfter(e){"string"==typeof e&&/^[0-9]+$/.test(e)?this._retryAfter=parseInt(e):this._retryAfter=0}canRetry(){return e=this.statusCode,c.includes(e);var e}retryAfter(){return this._retryAfter}},u=class extends Error{constructor(){super(),Object.setPrototypeOf(this,u.prototype),this.name="RequestTimedOutError",this.message="Request timed out"}canRetry(){return!0}retryAfter(){return 0}},h=class extends Error{constructor(){super(),this.name="AbortError",Object.setPrototypeOf(this,h.prototype),this.message="Response aborted"}canRetry(){return!0}retryAfter(){return 0}},m=class{constructor(e){e.forEach(((e,t)=>e.index=t)),this.columns=e}column(e,t=!0){for(let t=0;t<this.columns.length;t++){let n=this.columns[t];if(n.label===e)return n}if(t)throw new p(`Column ${e} not found!`);return o}toObject(e){let t={};for(let n=0;n<this.columns.length&&n<e.length;n++){let i=this.columns[n];t[i.label]=i.get(e)}return t}get(e,t){return this.column(t,!1).get(e)}};function f(e){return new m(e)}function g(e){let t,n,s=(new i).withReuse(),a=!0,r=0,o={error(t){e.error(t)},next(i){if(""===i)a=!0,t=void 0;else{let o=s.splitLine(i),c=s.lastSplitLength;if(!a)return e.next(o.slice(r,c),n);if(!t){t=new Array(c);for(let e=0;e<c;e++)t[e]=l()}if(o[0].startsWith("#")){if("#datatype"===o[0])for(let e=1;e<c;e++)t[e].dataType=o[e];else if("#default"===o[0])for(let e=1;e<c;e++)t[e].defaultValue=o[e];else if("#group"===o[0])for(let e=1;e<c;e++)t[e].group="t"===o[e][0]}else{""===o[0]?(r=1,t=t.slice(1)):r=0;for(let e=r;e<c;e++)t[e-r].label=o[e];n=f(t),a=!1}}return!0},complete(){e.complete()}};return e.useCancellable&&(o.useCancellable=e.useCancellable.bind(e)),e.useResume&&(o.useResume=e.useResume.bind(e)),o}var v="function"==typeof Symbol&&Symbol.observable||"@@observable",y=class{constructor(e,t){this.isClosed=!1;try{t({next:t=>{e.next(t)},error:t=>{this.isClosed=!0,e.error(t)},complete:()=>{this.isClosed=!0,e.complete()},useCancellable:e=>{this.cancellable=e}})}catch(t){this.isClosed=!0,e.error(t)}}get closed(){return this.isClosed}unsubscribe(){var e;null==(e=this.cancellable)||e.cancel(),this.isClosed=!0}};function w(){}var b=class{constructor(e,t){this.executor=e,this.decorator=t}subscribe(e,t,n){let i=function(e){let{next:t,error:n,complete:i}=e;return{next:t?t.bind(e):w,error:n?n.bind(e):w,complete:i?i.bind(e):w}}("object"!=typeof e||null===e?{next:e,error:t,complete:n}:e);return new y(this.decorator(i),this.executor)}[v](){return this}};Symbol.observable;var x={retryJitter:200,minRetryDelay:5e3,maxRetryDelay:125e3,exponentialBase:5,randomRetry:!0},C={batchSize:1e3,maxBatchBytes:5e7,flushInterval:6e4,writeFailed:function(){},writeSuccess:function(){},writeRetrySkipped:function(){},maxRetries:5,maxRetryTime:18e4,maxBufferLines:32e3,retryJitter:200,minRetryDelay:5e3,maxRetryDelay:125e3,exponentialBase:2,gzipThreshold:1e3,randomRetry:!0};function S(e,t){return function(n){let i="",s=0,a=0;for(;a<n.length;){let r=e.indexOf(n[a]);r>=0&&(i+=n.substring(s,a),i+=t[r],s=a+1),a++}return 0==s?n:(s<n.length&&(i+=n.substring(s,n.length)),i)}}S(", \n\r\t",["\\,","\\ ","\\n","\\r","\\t"]),S('"\\',['\\"',"\\\\"]),S(", =\n\r\t",["\\,","\\ ","\\=","\\n","\\r","\\t"]);var T="000000000",R=Date.now(),k=0;function E(){{let e=Date.now();e!==R?(R=e,k=0):k++;let t=String(k);return String(e)+T.substr(0,6-t.length)+t}}function L(){return String(Date.now())+T.substr(0,3)}function A(){return String(Date.now())}function M(){return String(Math.floor(Date.now()/1e3))}var B={s:M,ms:A,us:L,ns:E,seconds:M,millis:A,micros:L,nanos:E},O={s:e=>`${Math.floor(e.getTime()/1e3)}`,ms:e=>`${e.getTime()}`,us:e=>`${e.getTime()}000`,ns:e=>`${e.getTime()}000000`},I={error(e,t){console.error("ERROR: "+e,t||"")},warn(e,t){console.warn("WARN: "+e,t||"")}},_={error(e,t){I.error(e,t)},warn(e,t){I.warn(e,t)}};Symbol("FLUX_VALUE");var D=class{constructor(e){this.options={...x,...e},this.success()}nextDelay(e,t){let n=function(e,t){if(e){let t;return"function"==typeof e.retryAfter?e.retryAfter():(t=0,t)}return 0}(e);if(n&&n>0)return n+Math.round(Math.random()*this.options.retryJitter);if(t&&t>0){if(this.options.randomRetry){let e=Math.max(this.options.minRetryDelay,1),n=e*this.options.exponentialBase;for(let i=1;i<t;i++)if(e=n,n*=this.options.exponentialBase,n>=this.options.maxRetryDelay){n=this.options.maxRetryDelay;break}return e+Math.round(Math.random()*(n-e)+Math.random()*this.options.retryJitter)}let e=Math.max(this.options.minRetryDelay,1);for(let n=1;n<t;n++)if(e*=this.options.exponentialBase,e>=this.options.maxRetryDelay){e=this.options.maxRetryDelay;break}return e+Math.round(Math.random()*this.options.retryJitter)}return this.currentDelay?this.currentDelay=Math.min(Math.max(this.currentDelay*this.options.exponentialBase,1)+Math.round(Math.random()*this.options.retryJitter),this.options.maxRetryDelay):this.currentDelay=this.options.minRetryDelay+Math.round(Math.random()*this.options.retryJitter),this.currentDelay}success(){this.currentDelay=void 0}};function H(e){let t,n=e,i=e;for(;i.next;)i.next.expires<n.expires&&(t=i,n=i.next),i=i.next;return[n,t]}var N=class{constructor(e,t,n=(()=>{})){this.maxLines=e,this.retryLines=t,this.onShrink=n,this.size=0,this.closed=!1,this._timeoutHandle=void 0}addLines(e,t,n,i){if(this.closed||!e.length)return;let s=Date.now()+n;if(i<s&&(s=i),this.first&&this.size+e.length>this.maxLines){let t=this.size,n=.7*t;do{let[e,t]=H(this.first);this.size-=e.lines.length,t?t.next=e.next:(this.first=e.next,this.first&&this.scheduleRetry(this.first.retryTime-Date.now())),e.next=void 0,this.onShrink(e)}while(this.first&&this.size+e.length>n);_.error(`RetryBuffer: ${t-this.size} oldest lines removed to keep buffer size under the limit of ${this.maxLines} lines.`)}let a,r={lines:e,retryCount:t,retryTime:s,expires:i},o=this.first;for(;;){if(!o||o.retryTime>s){r.next=o,a?a.next=r:(this.first=r,this.scheduleRetry(s-Date.now()));break}a=o,o=o.next}this.size+=e.length}removeLines(){if(this.first){let e=this.first;return this.first=this.first.next,e.next=void 0,this.size-=e.lines.length,e}}scheduleRetry(e){this._timeoutHandle&&clearTimeout(this._timeoutHandle),this._timeoutHandle=setTimeout((()=>{let e=this.removeLines();e?this.retryLines(e.lines,e.retryCount,e.expires).catch((()=>{})).finally((()=>{this.first&&this.scheduleRetry(this.first.retryTime-Date.now())})):this._timeoutHandle=void 0}),Math.max(e,0))}async flush(){let e;for(;e=this.removeLines();)await this.retryLines(e.lines,e.retryCount,e.expires)}close(){return this._timeoutHandle&&(clearTimeout(this._timeoutHandle),this._timeoutHandle=void 0),this.closed=!0,this.size}},P=class{constructor(e,t,n,i){this.maxChunkRecords=e,this.maxBatchBytes=t,this.flushFn=n,this.scheduleSend=i,this.length=0,this.bytes=-1,this.lines=new Array(e)}add(e){let t=function(e){let t=e.length;for(let n=0;n<e.length;n++){let i=e.charCodeAt(n);i<128||(i>=128&&i<=2047?t++:i>=2048&&i<=65535?i>=55296&&i<=57343?t++:t+=2:t+=3)}return t}(e);0===this.length?this.scheduleSend():this.bytes+t+1>=this.maxBatchBytes&&this.flush().catch((e=>{})),this.lines[this.length]=e,this.length++,this.bytes+=t+1,(this.length>=this.maxChunkRecords||this.bytes>=this.maxBatchBytes)&&this.flush().catch((e=>{}))}flush(){let e=this.reset();return e.length>0?this.flushFn(e):Promise.resolve()}reset(){let e=this.lines.slice(0,this.length);return this.length=0,this.bytes=-1,e}},j=class{constructor(e,t,n,i,s){var a;this.transport=e,this.closed=!1,this._timeoutHandle=void 0,this.path=`/api/v2/write?org=${encodeURIComponent(t)}&bucket=${encodeURIComponent(n)}&precision=${i}`,null!=s&&s.consistency&&(this.path+=`&consistency=${encodeURIComponent(s.consistency)}`),this.writeOptions={...C,...s},this.currentTime=B[i],this.dateToProtocolTimestamp=O[i],this.writeOptions.defaultTags&&this.useDefaultTags(this.writeOptions.defaultTags),this.sendOptions={method:"POST",headers:{"content-type":"text/plain; charset=utf-8",...null==s?void 0:s.headers},gzipThreshold:this.writeOptions.gzipThreshold},this.writeBuffer=new P(this.writeOptions.batchSize,this.writeOptions.maxBatchBytes,(e=>(this._clearFlushTimeout(),this.sendBatch(e,this.writeOptions.maxRetries))),(()=>{this.writeOptions.flushInterval>0&&(this._clearFlushTimeout(),this.closed||(this._timeoutHandle=setTimeout((()=>this.sendBatch(this.writeBuffer.reset(),this.writeOptions.maxRetries).catch((e=>{}))),this.writeOptions.flushInterval)))})),this.sendBatch=this.sendBatch.bind(this),this.retryStrategy=(a=this.writeOptions,new D(a)),this.retryBuffer=new N(this.writeOptions.maxBufferLines,this.sendBatch,this.writeOptions.writeRetrySkipped)}sendBatch(e,t,n=Date.now()+this.writeOptions.maxRetryTime){let i=this,s=i.writeOptions.maxRetries+1-t;if(!this.closed&&e.length>0){if(n<=Date.now()){let t=new Error("Max retry time exceeded.");return i.writeOptions.writeFailed.call(i,t,e,s,n)||(_.error(`Write to InfluxDB failed (attempt: ${s}).`,t),Promise.reject(t))}return new Promise(((a,r)=>{let o,l={responseStarted(e,t){o=t},error(c){let p=i.writeOptions.writeFailed.call(i,c,e,s,n);if(!p)return c instanceof d&&c.json&&"string"==typeof c.json.error&&c.json.error.includes("hinted handoff queue not empty")?(_.warn("Write to InfluxDB returns: "+c.json.error),o=204,void l.complete()):!i.closed&&t>0&&(!(c instanceof d)||c.statusCode>=429)?(_.warn(`Write to InfluxDB failed (attempt: ${s}).`,c),i.retryBuffer.addLines(e,t-1,i.retryStrategy.nextDelay(c,s),n),void r(c)):(_.error("Write to InfluxDB failed.",c),void r(c));p.then(a,r)},complete(){if(204==o||null==o)i.writeOptions.writeSuccess.call(i,e),i.retryStrategy.success(),a();else{let e=`204 HTTP response status code expected, but ${o} returned`,t=new d(o,e,void 0,"0");t.message=e,l.error(t)}}};this.transport.send(this.path,e.join("\n"),this.sendOptions,l)}))}return Promise.resolve()}_clearFlushTimeout(){void 0!==this._timeoutHandle&&(clearTimeout(this._timeoutHandle),this._timeoutHandle=void 0)}writeRecord(e){if(this.closed)throw new Error("writeApi: already closed!");this.writeBuffer.add(e)}writeRecords(e){if(this.closed)throw new Error("writeApi: already closed!");for(let t=0;t<e.length;t++)this.writeBuffer.add(e[t])}writePoint(e){if(this.closed)throw new Error("writeApi: already closed!");let t=e.toLineProtocol(this);t&&this.writeBuffer.add(t)}writePoints(e){if(this.closed)throw new Error("writeApi: already closed!");for(let t=0;t<e.length;t++){let n=e[t].toLineProtocol(this);n&&this.writeBuffer.add(n)}}async flush(e){if(await this.writeBuffer.flush(),e)return await this.retryBuffer.flush()}close(){return this.writeBuffer.flush().finally((()=>{let e=this.retryBuffer.close();e&&_.error(`Retry buffer closed with ${e} items that were not written to InfluxDB!`,null),this.closed=!0}))}dispose(){return this._clearFlushTimeout(),this.closed=!0,this.retryBuffer.close()+this.writeBuffer.length}useDefaultTags(e){return this.defaultTags=e,this}convertTime(e){return void 0===e?this.currentTime():"string"==typeof e?e.length>0?e:void 0:e instanceof Date?this.dateToProtocolTimestamp(e):String("number"==typeof e?Math.floor(e):e)}};function z(e){let t={};return e.headers.forEach(((e,n)=>{let i=t[n];void 0===i?t[n]=e:Array.isArray(i)?i.push(e):t[n]=[i,e]})),t}var W=class{constructor(t){this.connectionOptions=t,this.chunkCombiner=e(),this.requestDecorator=function(){},this.defaultHeaders={"content-type":"application/json; charset=utf-8",...t.headers},this.connectionOptions.token&&(this.defaultHeaders.Authorization="Token "+this.connectionOptions.token),this.url=String(this.connectionOptions.url),this.url.endsWith("/")&&(this.url=this.url.substring(0,this.url.length-1)),this.url.endsWith("/api/v2")&&(this.url=this.url.substring(0,this.url.length-7),_.warn(`Please remove '/api/v2' context path from InfluxDB base url, using ${this.url} !`))}send(e,t,n,i){let s,a=function(e={}){let t=0,n={next:n=>{if(0===t&&e.next&&null!=n)return e.next(n)},error:n=>{0===t&&(t=1,e.error&&e.error(n))},complete:()=>{0===t&&(t=2,e.complete&&e.complete())},responseStarted:(t,n)=>{e.responseStarted&&e.responseStarted(t,n)}};return e.useCancellable&&(n.useCancellable=e.useCancellable.bind(e)),e.useResume&&(n.useResume=e.useResume.bind(e)),n}(i),r=!1,o=n.signal,l=()=>{},c=l;if(i&&i.useCancellable){let e=new AbortController;o||(o=e.signal,n={...n,signal:o}),o.addEventListener("abort",(()=>{c()})),i.useCancellable({cancel(){r=!0,e.abort()},isCancelled:()=>r||o.aborted})}this.fetch(e,t,n).then((async e=>{if(null!=i&&i.responseStarted&&a.responseStarted(z(e),e.status),await this.throwOnErrorResponse(e),e.body){let t,n=e.body.getReader();do{if(s&&await s,r)break;if(t=await n.read(),!1===a.next(t.value)){let e=a.useResume;if(!e){let e="Unable to pause, useResume is not configured!";return await n.cancel(e),Promise.reject(new Error(e))}s=new Promise((t=>{c=()=>{t(),s=void 0,c=l},e(c)}))}}while(!t.done)}else if(e.arrayBuffer){let t=await e.arrayBuffer();a.next(new Uint8Array(t))}else{let t=await e.text();a.next((new TextEncoder).encode(t))}})).catch((e=>{r||a.error(e)})).finally((()=>a.complete()))}async throwOnErrorResponse(e){if(e.status>=300){let t="";try{if(t=await e.text(),!t){let n=e.headers.get("x-influxdb-error");n&&(t=n)}}catch(t){throw _.warn("Unable to receive error body",t),new d(e.status,e.statusText,void 0,e.headers.get("retry-after"),e.headers.get("content-type"))}throw new d(e.status,e.statusText,t,e.headers.get("retry-after"),e.headers.get("content-type"))}}async*iterate(e,t,n){var i;let s=await this.fetch(e,t,n);if(await this.throwOnErrorResponse(s),s.body){let e=s.body.getReader();for(;;){let{value:t,done:a}=await e.read();if(a)break;if(null!=(i=n.signal)&&i.aborted)throw await s.body.cancel(),new h;yield t}}else if(s.arrayBuffer){let e=await s.arrayBuffer();yield new Uint8Array(e)}else{let e=await s.text();yield(new TextEncoder).encode(e)}}async request(e,t,n,i){var s,a;let r=await this.fetch(e,t,n),{headers:o}=r,l=o.get("content-type")||"";i&&i(z(r),r.status),await this.throwOnErrorResponse(r);let c=null!=(a=null==(s=n.headers)?void 0:s.accept)?a:l;return c.includes("json")?await r.json():c.includes("text")||c.startsWith("application/csv")?await r.text():void 0}fetch(e,t,n){let{method:i,headers:s,...a}=n,r=`${this.url}${e}`,o={method:i,body:"GET"===i||"HEAD"===i?void 0:"string"==typeof t?t:JSON.stringify(t),headers:{...this.defaultHeaders,...s},credentials:"omit",...this.connectionOptions.transportOptions,...a};return this.requestDecorator(o,n,r),fetch(r,o)}},V={header:!0,delimiter:",",quoteChar:'"',commentPrefix:"#",annotations:["datatype","group","default"]},q=class{constructor(e,t,n){this.transport=e,this.createCSVResponse=t,this.options="string"==typeof n?{org:n}:n}with(e){return new q(this.transport,this.createCSVResponse,{...this.options,...e})}response(e){let{org:t,type:n,gzip:i,headers:s}=this.options,a=`/api/v2/query?org=${encodeURIComponent(t)}`,r=JSON.stringify(this.decorateRequest({query:e.toString(),dialect:V,type:n})),o={method:"POST",headers:{"content-type":"application/json; encoding=utf-8","accept-encoding":i?"gzip":"identity",...s}};return this.createCSVResponse((e=>this.transport.send(a,r,o,e)),(()=>this.transport.iterate(a,r,o)))}iterateLines(e){return this.response(e).iterateLines()}iterateRows(e){return this.response(e).iterateRows()}lines(e){return this.response(e).lines()}rows(e){return this.response(e).rows()}queryLines(e,t){return this.response(e).consumeLines(t)}queryRows(e,t){return this.response(e).consumeRows(t)}collectRows(e,t){return this.response(e).collectRows(t)}collectLines(e){return this.response(e).collectLines()}queryRaw(e){let{org:t,type:n,gzip:i,headers:s}=this.options;return this.transport.request(`/api/v2/query?org=${encodeURIComponent(t)}`,JSON.stringify(this.decorateRequest({query:e.toString(),dialect:V,type:n})),{method:"POST",headers:{accept:"text/csv","accept-encoding":i?"gzip":"identity","content-type":"application/json; encoding=utf-8",...s}})}decorateRequest(e){var t;return"function"==typeof this.options.now&&(e.now=this.options.now()),e.type=null!=(t=this.options.type)?t:"flux",e}},F=q;function U(e,t){return t.toObject(e)}var J=class{constructor(e,t,n){this.executor=e,this.iterableResultExecutor=t,this.chunkCombiner=n}iterateLines(){return n(this.iterableResultExecutor())}iterateRows(){return async function*(e){let t,n,s=(new i).withReuse(),a=!0,r=0;for await(let i of e)if(""===i)a=!0,t=void 0;else{let e=s.splitLine(i),o=s.lastSplitLength;if(a){if(!t){t=new Array(o);for(let e=0;e<o;e++)t[e]=l()}if(e[0].startsWith("#")){if("#datatype"===e[0])for(let n=1;n<o;n++)t[n].dataType=e[n];else if("#default"===e[0])for(let n=1;n<o;n++)t[n].defaultValue=e[n];else if("#group"===e[0])for(let n=1;n<o;n++)t[n].group="t"===e[n][0]}else{""===e[0]?(r=1,t=t.slice(1)):r=0;for(let n=r;n<o;n++)t[n-r].label=e[n];n=f(t),a=!1}}else yield{values:e.slice(r,o),tableMeta:n}}}(n(this.iterableResultExecutor()))}lines(){return new b(this.executor,(e=>t(e,this.chunkCombiner)))}rows(){return new b(this.executor,(e=>t(g({next(t,n){e.next({values:t,tableMeta:n})},error(t){e.error(t)},complete(){e.complete()}}),this.chunkCombiner)))}consumeLines(e){this.executor(t(e,this.chunkCombiner))}consumeRows(e){this.executor(t(g(e),this.chunkCombiner))}collectRows(e=U){let t=[];return new Promise(((n,i)=>{this.consumeRows({next(n,i){let s=e.call(this,n,i);void 0!==s&&t.push(s)},error(e){i(e)},complete(){n(t)}})}))}collectLines(){let e=[];return new Promise(((t,n)=>{this.consumeLines({next(t){e.push(t)},error(e){n(e)},complete(){t(e)}})}))}},G=class{constructor(e){var t;if("string"==typeof e)this._options={url:e};else{if(null===e||"object"!=typeof e)throw new p("No url or configuration specified!");this._options=e}let n=this._options.url;if("string"!=typeof n)throw new p("No url specified!");n.endsWith("/")&&(this._options.url=n.substring(0,n.length-1)),this.transport=null!=(t=this._options.transport)?t:new W(this._options),this.processCSVResponse=(e,t)=>new J(e,t,this.transport.chunkCombiner)}getWriteApi(e,t,n="ns",i){return new j(this.transport,e,t,n,null!=i?i:this._options.writeOptions)}getQueryApi(e){return new F(this.transport,this.processCSVResponse,e)}};const Q=[{id:1,name:"NEOS Bien-être",icon:"./img/air-interieur.svg",field:"ContentApplications",link:"http://neos50.novatice.fr/milesight/",picture:"./img/Bienetre-pic.svg",type:""},{id:2,name:"Indice bien-être",icon:"./img/air-interieur.svg",field:"ContentApplications",link:"http://neos50.novatice.fr/milesight/",picture:"./img/Indice.svg",type:""},{id:3,name:"Ordinateurs",icon:"./img/pc.svg",field:"ContentApplications",link:"",picture:"./img/ordinateurs-pic.svg",type:""},{id:4,name:"NEOS Cam",icon:"./img/neoscam.svg",field:"ContentApplications",link:"",picture:"./img/cam-pic.svg",type:""},{id:5,name:"NEOS École",icon:"./img/neos-ecole.svg",field:"ContentApplications",link:"http://neos50.novatice.fr/jeumobile/",picture:"./img/neos-ecole.svg",type:""},{id:6,name:"Novalert",icon:"./img/novalert.svg",field:"ContentApplications",link:"http://neos50.novatice.fr/novalertmobile/",picture:"./img/Novalert-pic.svg",type:""},{id:7,name:"NEOS Serre",icon:"./img/serre.svg",field:"ContentApplications",link:"http://neos50.novatice.fr/serremobile/",picture:"./img/serre-pic.svg",type:""},{id:8,name:"NEOS Serre",icon:"./img/serre.svg",field:"ContentApplications",link:"http://neos50.novatice.fr/serremobile/",picture:"./img/serre-pic.svg",type:""},{id:9,name:"Vidéo-projecteur",icon:"./img/videoprojecteur.svg",field:"ContentApplications",link:"",picture:"./img/project-pic.svg",type:""},{id:10,name:"NEOS Météo",icon:"./img/meteo.svg",field:"ContentApplications",link:"http://neos50.novatice.fr/meteomobile/",picture:"./img/meteo-pic.svg",type:""},{id:11,name:"Télévision",icon:"./img/neoscam.svg",field:"ContentApplications",link:"",picture:"./img/neos-tv.svg",type:""},{id:12,name:"Dépense Gaz",icon:"./img/energie.svg",field:"ContentApplications",link:"http://neos50.novatice.fr/energiemobile/",picture:"./img/energie-pic.svg",type:""},{id:13,name:"Dépense Électricité",icon:"./img/energie.svg",field:"ContentApplications",link:"http://neos50.novatice.fr/energiemobile/",picture:"./img/energie-pic.svg",type:""},{id:14,name:"Dépense Eau",icon:"./img/energie.svg",field:"ContentApplications",link:"http://neos50.novatice.fr/energiemobile/",picture:"./img/energie-pic.svg",type:""}];async function Y(){try{const e=await fetch("/ApiAfficheurdynimac/getToken"),t=await e.json(),n=new Headers;new Date,n.append("Content-Type","application/x-ndjson"),n.append("Authorization",`Bearer ${t.access_token}`);const i=new Date;i.setMonth(i.getMonth()-1);const s=`${i.getFullYear()}-${(i.getMonth()+1).toString().padStart(2,"0")}-01`,a=new Date(i.getFullYear(),i.getMonth()+1,0).toISOString().split("T")[0],r={method:"GET",headers:n,redirect:"follow"},o=await fetch(`https://api.grdf.fr/adict/v2/pce/02100144637829/donnees_consos_publiees?date_debut=${s}&date_fin=${a}`,r),l=(await o.json()).consommation.volume_brut;return console.log(l),l}catch(e){}}document.addEventListener("DOMContentLoaded",(function(){const e=document.getElementById("addButton"),t=document.getElementById("popup"),n=document.getElementById("popupList"),i=document.getElementById("closeButton"),s=document.getElementById("ContentApplications");let a=!1;$(document).ready((function(){let r=null;var o,l=!1;function c(e,t){r=setTimeout((function(){l||function(e,t){let n=$(".context-menu");if(n.length)n.show();else{n=$("<div class='context-menu'></div>");const e=$("<div class='context-menu-option delete-btn' ><span>Supprimer </span> <img class='delete-img' src='./img/delete-app.svg' /></div>"),i=$("<div class='context-menu-option create-rect-widget-btn'><span>Créer un widget rectangulaire</span></div>"),s=$("<div class='context-menu-option create-square-img-widget-btn'><span>Créer un widget carré avec image</span></div>"),a=$("<div class='context-menu-option create-square-data-widget-btn'><span>Créer un widget carré avec données</span></div>");e.on("click",(function(){console.log(t),u(t),n.hide()})),i.on("click",(function(){createRectangularWidget(),n.hide()})),s.on("click",(function(){n.hide()})),a.on("click",(function(){n.hide()})),n.append(e,i,s,a),$("body").append(n)}n.css({left:e.targetTouches[0].pageX+10+"px",top:e.targetTouches[0].pageY+10+"px"}),$(`.carreau-parent[data-app-id='${t}']`).on("click",(function(e){e.stopPropagation();const t=$(this).find(".linkapp").attr("href");t&&(window.location.href=t)}))}(e,t)}),500)}function p(){clearTimeout(r)}function d(){var e;l?($(".slick-slide").sortable("disable"),l=!1):($(".slick-slide").sortable({items:".carreau-parent",connectWith:".carreau-parent",placeholder:"sortable-placeholder",forcePlaceholderSize:!0,tolerance:"pointer",start:function(t,n){e=$(n.item).parent(),$("#ContentApplications").slick("slickSetOption","swipe",!1,!0),n.placeholder.addClass("ui-sortable-placeholder")},sort:function(e,t){var n=e.clientX,i=window.innerWidth,s=.05*i,a=$("#ContentApplications").slick("slickCurrentSlide");if(n<s)$("#ContentApplications").slick("slickGoTo",a-1);else if(n>i-s){$("#ContentApplications").slick("slickGoTo",a+1),$(".slick-slide").eq(a+1).append(t.item);var r=$("#ContentApplications").scrollLeft()+i;$("#ContentApplications").animate({scrollLeft:r},500)}},stop:function(t,n){var i=$(n.item).parent();if(e.is(i));else if(e.index()<i.index()){if(i.children().length>=3){var s=i.children().first();if(i.children().length>=3&&i.prev().append(s),i.prev().children().length>=3){var a=i.prev().children().first();i.parent().children().first().append(a)}}}else if(i.children().length>=3){var r=i.children().last();if(i.children().length>=3&&i.next().prepend(r),i.next().children().length>=3){var o=i.next().children().last();i.parent().children().last().prepend(o)}}$("#ContentApplications").slick("slickSetOption","swipe",!0,!0)},update:function(){var e,t;e=$(this).sortable("toArray",{attribute:"data-app-id"}).join(";"),localStorage.setItem("positions",e),console.log(e),t=this,setTimeout((()=>{$(t).toggleClass("ui-sortable")}),500),setTimeout((()=>{$(t).toggleClass("ui-sortable")}),500)}}).sortable("enable"),l=!0)}function u(e){$(".context-menu").remove();const t=$(`.carreau-parent[data-app-id = ${e}]`);console.log(t,"appElement",e),t.remove(),function(e){const t=localStorage.getItem("addedApplications");if(console.log("localStorage.getItem('addedApplications');",t),t){let n=JSON.parse(t);n=n.filter((t=>t&&t.id!==e)),localStorage.setItem("addedApplications",JSON.stringify(n))}}(e),contextMenuVisible=!1}document.addEventListener("click",(function(e){$(".context-menu").hide()})),document.getElementById("editbutton").addEventListener("click",(function(){d()})),i.addEventListener("click",(()=>{s.classList.remove("hidden"),t.classList.add("hidden")})),e.addEventListener("click",(()=>{s.classList.add("hidden"),t.classList.remove("hidden"),a||(Q.forEach((e=>{const i=document.createElement("div");i.classList.add("image-add"),i.innerHTML=`<div class="img-icon"><img src="${e.picture}" alt="${e.name}"></div>`,n.appendChild(i);const a=document.createElement("li");a.textContent=e.name,i.appendChild(a),i.addEventListener("click",(async()=>{const n=document.createElement("div"),i=document.createElement("a"),a=document.createElement("div");switch(n.classList.add("carreau-parent"),a.classList.add("carreau"),i.classList.add("application-lien"),i.href=`${e.link}`,e.id){case 1:s.appendChild(n),n.appendChild(i),i.appendChild(a),a.innerHTML='<p class="place-name">Bureau.C</p>\n                <p class="statut">Qualité de l\'air\n                </p>\n                <div class="values-statu">\n                  <div class="oxy">\n                    <div class="text-des"><p>CO2</p><span class="etat">Très bien</span></div>\n                    <p class="oxy-value">1607 <span class="petit">ppm</span></p>\n                  </div>\n                  <div class="humidite">\n                  <div class="text-des"> <p>Humidité</p><span class="etat">Modéré</span></div>\n                  <div class="circle-wrapper">\n    <div class="circle-fill"></div>\n    <div class="circle"></div>\n   \n                  <p class="humidite-value" id="humid-val">\n                    \n                    56<span class="petit">%</span></p> </div>\n                  </div>\n                  <div class="temp">\n                  <div class="text-des"><p>Température</p><span class="etat">Mauvais</span></div>\n                    <p class="temp-value">18<span class="petit">°c</span></p>\n                  </div>\n                </div>\n                ',location.reload();break;case 2:s.appendChild(n),n.appendChild(i),i.appendChild(a),a.innerHTML='<p class="place-name">Bureau.C</p>\n                  <p class="statut">Mauvais\n                  </p>\n                  <div class="pic-indice"><p class="value-bien">4</p>\n                  <img class="bienEtreGraph" src="./img/graphe.png"/> </div>\n                  <div class="lettre-statu">\n                    <p class="indice">Indice bien-être</p>\n                    <p class="etat-indice">Très bien</p>\n                  </div>\n  \n                  ',location.reload();break;case 7:const t=await ee();console.log(t),a.innerHTML=`<p class="name-app">${e.name}</p>\n                <p class="exp-name">Radis exp</p>\n                <img src="/serres/visionneuse/${t}"/>\n                `,location.reload();break;case 8:s.appendChild(n),n.appendChild(i),i.appendChild(a);const r=await te("5d09f0ae-fed4-400f-b3ee-55471e2e8c22");console.log(r,"apiDonner"),a.innerHTML=`<p class="name-app">${e.name}</p>\n                  <p class="exp-name">Radis exp</p>\n                  <div class="donnés">\n                  <div class="consomation-value">\n                  <div class="donnees-all chart-popup_home">\n                    <p>Humidité air</p>\n                    <div class="donnees-one">\n                      <div class="img-ai"r><img src="./img/air-s.svg" /></div>\n                      <span id="valair">${r.data.value.cloud[1].toFixed(1)}%</span>\n                    </div>\n                  </div>\n                  <div class="donnees-all chart-popup_home">\n                    <p>Humidité sol</p>\n                    <div class="donnees-one">\n                      <div class="img-sol"><img src="./img/sol-s.svg" /></div>\n                      <span id="valsol">${r.data.value.pump}</span>\n                    </div>\n                  </div>\n                </div>\n                <div class="consomation-value">\n                  <div class="donnees-all chart-popup_home">\n                    <p>Température</p>\n                    <div class="donnees-one">\n                      <div class="img-temp"><img src="./img/temp-s.svg" /></div>\n                      <span id="valtemp">${r.data.value.cloud[2].toFixed(1)}°C</span>\n                    </div>\n                  </div>\n                  <div class="donnees-all chart-popup_home">\n                    <p>Photorésistance</p>\n                    <div class="donnees-one">\n                      <div class="img-resi"><img src="./img/photoresis-s.svg" /></div>\n                      <span id="vallum">${r.data.value.cloud[3].toFixed(1)} ohms</span>\n                    </div>\n                  </div>\n                </div>\n  \n                  </div>\n                  `,location.reload();break;case 10:s.appendChild(n),n.appendChild(i),i.appendChild(a),a.innerHTML='\n                  <p class="name-city">\n                  Boisguillaume\n                  </p>\n                  <p class="local">\n                    Météo local\n                  </p>\n                  <div class="ele-center">\n                      <p class="meteo-val">-3<span class="unit">°C</span></p>\n                      <div class="direction"><p>Nord-Est :</p> <img class="dir-img" src="" /> <p class="dir-valeur">3.9 km/h</p></div>\n                      <div class="precip"><p>Précipitation :</p><p class="dir-valeur">0.3 mm/h</p></div>\n                      <div class="humidty"><p>Humidité :</p><p class="dir-valeur">30%</p></div>\n                      </div>\n                ',location.reload();break;case 12:s.appendChild(n),n.appendChild(i),i.appendChild(a),a.innerHTML='\n                  <p class="para-gaz">Relevé gaz</p>\n                  <div class="pic-gaz">\n                    <p class="value-gaz">\n                      76 kWh\n                      <span class="date">aujourd\'hui</span>\n                    </p>\n                    <img class="GazGraph" src="./img/gaz.svg"/> \n                  </div>\n                  ',location.reload();break;case 13:s.appendChild(n),n.appendChild(i),i.appendChild(a),a.innerHTML='\n                <p class="para-elec">Relevé électricité</p>\n                <div class="pic-elec">\n                  <p class="value-elec">\n                    184 kWh\n                    <span class="date">aujourd\'hui</span>\n                  </p>\n                  <img class="elecGraph" src="./img/elec.svg"/> \n                </div>\n                \n                ',location.reload();break;case 14:s.appendChild(n),n.appendChild(i),i.appendChild(a),a.innerHTML='\n                <p class="para-eau">Relevé d\'eau</p>\n                <div class="pic-eau">\n                  <p class="value-eau">\n                    184 kWh<br>\n                    <span class="date">aujourd\'hui</span>\n                  </p>\n                  <img class="eauGraph" src="./img/eau.svg"/> \n                </div>\n                ',location.reload();break;default:console.log(` ${e.name}`)}const r=localStorage.getItem("addedApplications");let o=[];r&&(o=JSON.parse(r)),o.push(e),localStorage.setItem("addedApplications",JSON.stringify(o)),s.classList.remove("hidden"),t.classList.add("hidden")})),i.appendChild(a)})),a=!0)}));var h=document.getElementById("myModal");window.saveCroppedImage=function(){o.getCroppedCanvas({width:390,height:80});var e=o.getCroppedCanvas().toDataURL();localStorage.setItem("profilePic",e),$(".profile-pic").attr("src",e),$("#popupBanniere img").remove(),h.style.display="none",o&&o.destroy()};var m=localStorage.getItem("profilePic");m&&$(".profile-pic").attr("src",m);var f=localStorage.getItem("wallpaperImage");f&&$("body").css("background-image","url("+f+")"),$("#popupBanniere").hide(),$("#optionsMenu").hide(),$(".file-upload").on("change",(function(){!function(e){if(e.files&&e.files[0]){var t=new FileReader;t.onload=function(e){var t=new Image;t.src=e.target.result,t.onload=function(){$("#popupBanniere").hide(),h.style.display="block";var e=document.getElementById("cropper-container");e.innerHTML="",e.appendChild(t),o=new Cropper(t,{aspectRatio:4.875,viewMode:2})}},t.readAsDataURL(e.files[0])}}(this)})),$(".wallpaper-upload").on("change",(function(){!function(e){if(e.files&&e.files[0]){var t=new FileReader;t.onload=function(e){var t=e.target.result;localStorage.setItem("wallpaperImage",t),$("body").css("background-image","url("+t+")"),closePopup()},t.readAsDataURL(e.files[0])}}(this)})),$(".upload-button").on("click",(function(){$("#popupBanniere").show()})),$(".wallpaper-button").on("click",(function(){$("#popupWallpaper").show()})),window.togglePopup=function(){$("#popupBanniere").toggle()},window.changeWallpaper=function(){$("#popupWallpaper").toggle()},window.closePopup=function(){$("#popupBanniere").hide(),$("#popupWallpaper").hide(),$(".file-upload, .wallpaper-upload").val("")},window.showOptions=function(){$("#optionsMenu").toggle()},function(){var e=localStorage.getItem("positions");if(e){var t=e.split(";");$.each(t,(function(e,t){$('[data-app-id="'+t+'"]').appendTo(".content-section")}))}}(),async function(){const e=localStorage.getItem("addedApplications");if(e){const i=JSON.parse(e),a=i.filter((e=>null!==e)).map((async e=>{if(e){const n=document.createElement("div"),a=document.createElement("a"),r=document.createElement("div");switch(n.classList.add("carreau-parent","long-press","widget-container"),r.classList.add("carreau"),a.classList.add("application-lien"),a.href=`${e.link}`,n.setAttribute("data-app-id",e.id),e.id){case 1:s.insertBefore(n,s.firstChild),n.appendChild(a),a.appendChild(r),localStorage.setItem("addedApplications",JSON.stringify(i)),r.innerHTML='<p class="place-name">Bureau.C</p>\n                <p class="statut">Qualité de l\'air\n                </p>\n                <div class="values-statu">\n                  <div class="oxy">\n                    <div class="text-des"><p>CO2</p></div>\n                    <p class="oxy-value">1607 <span class="petit">ppm</span></p>\n                  </div>\n                  <div class="humidite">\n                  <div class="text-des"> <p>Humidité</p><span class="etat">Modéré</span></div>\n                  <div class="circle-wrapper">\n    <div class="circle-fill"></div>\n    <div class="circle"></div>\n   \n                  \n    <p class="humidite-value" id="humid-val">\n                    \n                    56<span class="petit">%</span></p> </div>\n                  </div>\n                  <div class="temp">\n                  <div class="text-des"><p>Température</p></div>\n                    <p class="temp-value">18<span class="petit">°c</span></p>\n                  </div>\n                </div>';break;case 2:s.appendChild(n),n.appendChild(a),a.appendChild(r),localStorage.setItem("addedApplications",JSON.stringify(i)),r.innerHTML='<p class="place-name">Bureau.C</p>\n                <p id="etat-indice_" class="statut">Mauvais\n                </p>\n                <div class="pic-indice">\n                <canvas style="width: 240px;height: 70px;" class="bienEtreGraph" id="foo"></canvas> </div>\n                <div class="lettre-statu">\n                  <p class="indice">Indice bien-être</p>\n                  <p id="etat-indice" class="etat-indice">Très bien</p>\n                </div>';break;case 7:s.appendChild(n),n.appendChild(a),a.appendChild(r),localStorage.setItem("addedApplications",JSON.stringify(i));const o=await ee();r.innerHTML=`<p class="name-app">${e.name}</p>\n                <p class="exp-name">Radis exp</p>\n                <img src="/serres/visionneuse/${o}"/>\n                `;break;case 8:s.append(n),n.appendChild(a),a.appendChild(r),localStorage.setItem("addedApplications",JSON.stringify(i));const l=await te("5d09f0ae-fed4-400f-b3ee-55471e2e8c22");console.log(l,"apiDonner"),r.innerHTML=`<p class="name-app">${e.name}</p>\n              <p class="exp-name">Radis exp</p>\n              <div class="donnés">\n              <div class="consomation-value">\n              <div class="donnees-all chart-popup_home">\n                <p>Humidité air</p>\n                <div class="donnees-one">\n                  <div class="img-ai"r><img src="./img/air-s.svg" /></div>\n                  <span id="valair">${l.data.value.cloud[1].toFixed(1)}%</span>\n                </div>\n              </div>\n              <div class="donnees-all chart-popup_home">\n                <p>Humidité sol</p>\n                <div class="donnees-one">\n                  <div class="img-sol"><img src="./img/sol-s.svg" /></div>\n                  <span id="valsol">${l.data.value.pump}</span>\n                </div>\n              </div>\n            </div>\n            <div class="consomation-value">\n              <div class="donnees-all chart-popup_home">\n                <p>Température</p>\n                <div class="donnees-one">\n                  <div class="img-temp"><img src="./img/temp-s.svg" /></div>\n                  <span id="valtemp">${l.data.value.cloud[2].toFixed(1)}°C</span>\n                </div>\n              </div>\n              <div class="donnees-all chart-popup_home">\n                <p>Photorésistance</p>\n                <div class="donnees-one">\n                  <div class="img-resi"><img src="./img/photoresis-s.svg" /></div>\n                  <span id="vallum">${l.data.value.cloud[3].toFixed(1)} ohms</span>\n                </div>\n              </div>\n            </div>\n\n              </div>\n              `;break;case 10:s.appendChild(n),n.appendChild(a),a.appendChild(r);const c=await async function(e){const t=await Z.collectRows('from(bucket:"lorawan") |> range(start: today()) |> filter(fn: (r) => r._measurement == "S2120" and r.DeviceID == "2cf7f1c044300040")'),n=[],i={humidity:"#humidite .value",uv_index:"#indice_uv .value",wind_speed:"#vitesse_du_vent .value",temperature:"#temperature .value",pressure:"#pression .value",illumination:"#luminosite .value",wind_direction:"#direction_du_vent .value",rain_gauge:"#precipitation .value"};t.forEach(((e,t)=>{var i={name:e._field,value:e._value,time:e._time};n.push(i)}));var s=n.reduce((function(e,t){var n=e.reduce((function(e,n,i){return n.name===t.name?i:e}),-1);if(n>=0)e[n].value=e[n].value.concat(t.value),e[n].time=e[n].time.concat(t.time);else{var i={name:t.name,value:[t.value],time:[t.time]};e=e.concat([i])}return e}),[]);const a={};return s.forEach((e=>{if(i[e.name]&&e.value.length>0){const t=e.value[e.value.length-1];a[e.name]=t}})),console.log(a),a}(),p=(t=c.wind_direction)>=337.5||t<22.5?"Nord":t>=22.5&&t<67.5?"Nord-Est":t>=67.5&&t<112.5?"Est":t>=112.5&&t<157.5?"Sud-Est":t>=157.5&&t<202.5?"Sud":t>=202.5&&t<247.5?"Sud-Ouest":t>=247.5&&t<292.5?"Ouest":"Nord-Ouest";console.log(c.humidity,"apiMeteo"),localStorage.setItem("addedApplications",JSON.stringify(i)),r.innerHTML=`\n                  <p class="name-city">\n                  Boisguillaume\n                  </p>\n                  <p class="local">\n                    Météo local\n                  </p>\n                  <div class="ele-center">\n                      <p class="meteo-val">${c.temperature}<span class="unit">°C</span></p>\n                      <div class="direction"><p>${p} :</p> <img class="dir-img" src="" /> <p class="dir-valeur">${c.wind_speed} km/h</p></div>\n                      <div class="precip"><p>Précipitation :</p><p class="dir-valeur">${c.rain_gauge} mm/h</p></div>\n                      <div class="humidty"><p>Humidité :</p><p class="dir-valeur">${c.humidity}%</p></div>\n                      </div>\n                `;break;case 12:s.append(n),n.appendChild(a),a.appendChild(r);const d=await Y();r.innerHTML=`\n                  <p class="para-gaz">Relevé gazZ</p>\n                  <div class="pic-gaz">\n                    <p class="value-gaz">\n                      ${d||".."} kWh <br>\n                      <span class="date">Mois précédent</span>\n                    </p>\n                    <img class="GazGraph" src="./img/gaz.svg"/> \n                  </div>`;break;case 13:s.append(n),n.appendChild(a),a.appendChild(r),localStorage.setItem("addedApplications",JSON.stringify(i));const u=await async function(){try{const e=await fetch("/ApiAfficheurdynimac/energy"),t=await e.json();if(t.data&&t.data.length>0){const e=t.data,n=e[e.length-1].kwh;return console.log(n),n}return console.log("The energyData array is empty."),null}catch(e){return console.error("Error fetching data:",e),null}}();r.innerHTML=`\n              <p class="para-elec">Relevé électricité</p>\n              <div class="pic-elec">\n                <p class="value-elec">\n                 ${u} kWh <br>\n                  <span class="date">Mois précédent</span>\n                </p>\n                <img class="elecGraph" src="./img/elec.svg"/> \n              </div>\n              \n              `;break;case 14:s.append(n),n.appendChild(a),a.appendChild(r);const h=await async function(){try{const e=new G({url:"https://influx.novatice.com",token:"7g22yYxVUMzTH4DRjIVWbIABsjc5eWS7TGAVxtsSN0c5deRq3S5xnFQ0V455W4EgOFqHn164PZZ7QPCbo83lRg=="}).getQueryApi("Novatice"),t=new Date;t.setMonth(t.getMonth()-1),t.setDate(1);const n=t.toISOString().slice(0,10),i=`from(bucket:"lorawan") |> range(start: ${new Date(t.getFullYear(),t.getMonth(),0).toISOString().slice(0,10)}, stop: ${n}) |> filter(fn: (r) => r._measurement == "HRL-c-G3" and r._field == "Index0h00")  |> aggregateWindow(every: 30d, fn: last, createEmpty: false)`,s=await e.collectRows(i);return s[s.length-1]._value}catch(e){throw console.error("Error in Collecteau:",e),e}}();localStorage.setItem("addedApplications",JSON.stringify(i)),r.innerHTML=`\n                <p class="para-eau">Relevé d'eau</p>\n                <div class="pic-eau">\n                  <p class="value-eau">\n                    ${h} Litres <br>\n                    <span class="date">Mois précédent</span>\n                  </p>\n                  <img class="eauGraph" src="./img/eau.svg"/> \n                </div>\n                `;break;default:console.log(` ${e.name}`)}return widgetKey}var t}));var t=localStorage.getItem("positions");if(t){var n=t.split(";");$.each(n,(function(e,t){$('[data-app-id="'+t+'"]').appendTo(".content-section")})),$("<div class='context-menu-option'>Supprimer</div>").on("click",(function(){console.log("Supprimer cliqué"),u(widgetKey),contextMenu.remove(),contextMenuVisible=!1}))}await Promise.all(a)}}(),$(document).on("mousedown",(function(e){!$(e.target).closest(".carreau-parent").length&&l&&d()})),$(".carreau-parent").each((function(){const e=$(this).data("app-id");$(this).on("mousedown",(function(t){c(t,e)})),$(this).on("mouseup",p),$(this).on("mouseout",p),$(this).on("touchstart",(function(t){c(t,e)})),$(this).on("touchend",p),$(this).on("click",(function(e){const t=$(this).find(".linkapp").attr("href");t&&(window.location.href=t)}))})),$("#ContentApplications").slick({slidesToShow:1,rows:2,arrows:!1,slidesPerRow:2,dots:!0});var g=$(".slick-dots");$("#ContentApplications .slick-slide").length<=1?g.css("display","none"):g.css("display","block")}))})),document.addEventListener("contextmenu",(function(e){e.preventDefault()})),document.getElementById("HomeButton").addEventListener("click",(()=>{const e=document.getElementById("popup");document.getElementById("ContentApplications").classList.remove("hidden"),e.classList.add("hidden")})),Y();const Z=new G({url:"https://influx.novatice.com",token:"7g22yYxVUMzTH4DRjIVWbIABsjc5eWS7TGAVxtsSN0c5deRq3S5xnFQ0V455W4EgOFqHn164PZZ7QPCbo83lRg=="}).getQueryApi("Novatice"),X=new G({url:"https://influx.novatice.com",token:"7g22yYxVUMzTH4DRjIVWbIABsjc5eWS7TGAVxtsSN0c5deRq3S5xnFQ0V455W4EgOFqHn164PZZ7QPCbo83lRg=="}).getQueryApi("Novatice");var K=0;async function ee(){try{const e=await fetch("/apiSerre/pictures");if(!e.ok)throw new Error(`HTTP error! Status: ${e.status}`);const t=await e.json(),n=t[t.length-1];return console.log("Last Filename:",n),n}catch(e){throw console.error("Error fetching image filenames:",e),e}}async function te(e){try{const t=await fetch(`/apiSerre/dataMQTT/${e}`);if(!t.ok)throw new Error(`HTTP error! Status: ${t.status}`);const n=await t.json(),i=n[e]?n[e][0]:null;if(i){const e=JSON.parse(i.data.value),t=e.cloud.slice(1,-1).split(",").map(Number);e.cloud=t,i.data.value=e}return i}catch(e){throw console.error("Error fetching MQTT data:",e),e}}!async function(e){K=0;const t=await X.collectRows('from(bucket: "lorawan") |> range(start: -1d) |> filter(fn: (r) => r._measurement == "AM103" and r.DeviceID == "24e124725c307318") |> last()'),n=[];t.forEach(((e,t)=>{var i={name:e._field,value:e._value,time:e._time,id:e.DeviceID};n.push(i)}));var i=n.reduce((function(e,t){var n=e.reduce((function(e,n,i){return n.name===t.name?i:e}),-1);if(n>=0)e[n].value=e[n].value.concat(t.value),e[n].time=e[n].time.concat(t.time);else{var i={name:t.name,value:[t.value],time:[t.time],id:t.id};e=e.concat([i])}return e}),[]);const s={humidity:{symbole:" ppm",name:"Composés organiques volatils"},co2:{symbole:" ppm",name:"CO2",Normale:[0,799],Medium:[800,1199],Mauvaise:[1200,9e3]},temperature:{symbole:" °c",name:"Température"}};console.log(i,"output"),i.forEach((e=>{if(e.name in s)switch(e.name){case"co2":let t=+e.value;K+=t,console.log(e.value[0],"indicateur.value"),document.querySelectorAll(".oxy-value").forEach((t=>{t.innerHTML=e.value[0]+' <span class="petit">ppm</span>'}));break;case"temperature":console.log(e.value[0],"temp"),document.querySelectorAll(".temp-value").forEach((t=>{t.innerHTML=e.value[0]+' <span class="petit">°c</span>'}));break;case"humidity":console.log(e.value[0],"hum"),document.querySelectorAll(".humidite-value").forEach((t=>{t.innerHTML=e.value[0]+' <span class="petit">%</span>'}))}})),function(e){var t=document.getElementById("foo"),n=new Gauge(t).setOptions({angle:0,lineWidth:.06,radiusScale:.4,pointer:{length:.5,strokeWidth:.03,color:"#000000"},staticLabels:{font:"10px sans-serif",labels:[1,2,3,4,5],fractionDigits:0},staticZones:[{strokeStyle:"#00a710",min:1,max:2},{strokeStyle:"#00a710",min:2,max:3},{strokeStyle:"#f4ae00",min:3,max:4},{strokeStyle:"#f4ae00",min:4,max:5},{strokeStyle:"#fd3232",min:5,max:6}],limitMax:!1,limitMin:!1,highDpiSupport:!0});n.minValue=1,n.maxValue=6;let i=document.getElementById("etat-indice"),s=document.getElementById("etat-indice_");if("co2"===e.name){let t=+e.value;t>=0&&t<=400?(n.set(1),i.innerHTML="Très bien",s.innerHTML="Très bien"):t>=401&&t<=800?(n.set(2),i.innerHTML="Bon",s.innerHTML="Bon"):t>=801&&t<=1200?(n.set(3),i.innerHTML="Moyen",s.innerHTML="Moyen"):t>=1201&&t<=1600?(n.set(4),i.innerHTML="Médiocre",s.innerHTML="Médiocre"):(n.set(5),i.innerHTML="Mauvais",s.innerHTML="Mauvais")}}({name:"co2",value:K})}(),te("5d09f0ae-fed4-400f-b3ee-55471e2e8c22");const ne=parseInt(document.getElementById("humid-val").textContent);document.getElementById("circle-fill").style.setProperty("--fill-width",ne+"%")})();